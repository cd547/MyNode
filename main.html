<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
<style>
    .node {position: absolute;}
</style>


    <script src="js/jquery-3.3.1.min.js"></script>

    <link rel="stylesheet" href="css/bootstrap.min.css">
</head>
<body>

<div class="row" >
    <div class="col-md-9" id="background" style="min-height: 500px;background-color: #cccccc;">

    </div>
    <div class="col-md-3">
        <table class="table table-bordered table-condensed">
            <tr><td style="width:60px;"><span class="badge badge-primary">名称</span></td><td><span id="elementname"></span></td></tr>
            <tr><td style="width:60px;"><span class="badge badge-primary">位置</span></td><td><span id="elementpos"></span></td></tr>
        </table>
    </div>

</div>




    <div class="state">

    </div>
    <div class="state1">
        <button id="dd" onclick="active()">active</button>
        <button id="add" onclick="noactive()">no active</button>
        <button id="create0" onclick="create(0)">add0</button>
        <button id="create1" onclick="create(1)">add1</button>
        <button id="create2" onclick="create(2)">add2</button>
        <button id="create3" onclick="create(3)">add3</button>
        <button id="create4" onclick="create(4)">add4</button>
        <button id="create5" onclick="create(5)">add5</button>
        <button id="create6" onclick="create(6)">add6</button>
        <button id="create7" onclick="create(7)">add7</button>
    </div>

<script src="js/bootstrap.min.js"></script>
<script>
//node类
nodenum=0;
var Node={

    createNew:function(type){
        //
        var node={};
        node.id="node"+nodenum;
        node.active=false;
        node.position=[0,0];
        node.content=node.id;
        var types=["primary","secondary","success","danger","warning","info","light","dark"];
        node.type=types[type];
        node.create=function(){
            var htmltext="<button id="+node.id+" type=\"button\" class=\"btn btn-lg btn-outline-"+node.type+" node\">"+node.content+"</button>";
            $("#background").append(htmltext);
            nodenum++;
        };
        return node;
    }
};


function create(type)
{
    var newnode=Node.createNew(type);
    newnode.create();
}
    //
    var selectelement=null;
    //声明需要用到的变量
    var mx = 0,my = 0;      //鼠标x、y轴坐标（相对于left，top）
    var dx = 0,dy = 0;      //对话框坐标（同上）
    var isDraging = false;      //不可拖动

$('body').on('mousedown','.btn',function(e){
    selectelement=$(this);
    $("#elementname").text(this.id);
    $("#elementpos").text("X="+$(this).position().left+",Y="+$(this).position().top);

    e = e || window.event;
    mx = e.pageX;     //点击时鼠标X坐标
    my = e.pageY;     //点击时鼠标Y坐标
    dx = selectelement.offset().left;
    dy = selectelement.offset().top;
    isDraging = true;      //标记对话框可拖动
    $('.state').text("true");
});

    $('body').on('mousemove','#background',function(e) {
        var e = e || window.event;
        var x = e.pageX;      //移动时鼠标X坐标
        var y = e.pageY;      //移动时鼠标Y坐标
        if(isDraging){        //判断对话框能否拖动
            var moveX = dx + x - mx;      //移动后对话框新的left值
            var moveY = dy + y - my;      //移动后对话框新的top值
            //设置拖动范围

            var dialogW = selectelement.width();
            var dialogH = selectelement.height();
            var pageW = $("#background").width()-0.5*dialogW+10;
            var pageH = $("#background").height()-0.5*dialogH-5;
            var maxX = pageW - dialogW;       //X轴可拖动最大值
            var maxY = pageH - dialogH;       //Y轴可拖动最大值
            moveX = Math.min(Math.max(0,moveX),maxX);     //X轴可拖动范围
            moveY = Math.min(Math.max(0,moveY),maxY);     //Y轴可拖动范围
            //重新设置对话框的left、top
            selectelement.css({"left":moveX + 'px',"top":moveY + 'px'});
            $("#elementpos").text("X="+moveX.toFixed(0)+",Y="+moveY.toFixed(0));
        };
    });

    $('body').on('mouseup','.row',function(){
        //selectelement=$(this);
        isDraging = false;
        $('.state').text("false");
    });

    function active(){
        selectelement.removeClass("btn btn-lg btn-outline-primary node");
        selectelement.addClass("btn btn-lg btn-outline-primary node active");
    }
    function noactive(){
        selectelement.removeClass("btn btn-lg btn-outline-primary node active");
        selectelement.addClass("btn btn-lg btn-outline-primary node");
    }
</script>

</body>
</html>