<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        .node {position: absolute;}
    </style>


    <script src="js/jquery-3.3.1.min.js"></script>

    <link rel="stylesheet" href="css/bootstrap.min.css">
</head>
<body>

<div class="row" >
    <div class="col-md-9" id="background" style="min-height: 500px;background-color: #cccccc;">

    </div>
    <div class="col-md-3">
        <table class="table table-bordered table-condensed">

            <tr><td style="width:60px;"><span class="badge badge-primary">NodeID</span></td><td><span id="elementid"></span></td></tr>
            <tr><td style="width:60px;"><span class="badge badge-primary">名称</span></td><td><span id="elementname"></span></td></tr>
            <tr><td style="width:60px;"><span class="badge badge-primary">位置</span></td><td><span id="elementpos"></span></td></tr>
            <tr><td style="width:60px;"><span class="badge badge-primary">状态</span></td>
                <td><span id="elementstatus">NULL</span>
                    <button class="btn btn-sm btn-primary" id="setactive">Active</button>
                    <button class="btn btn-sm btn-secondary" id="setinactive">Inactive</button>
                </td>
            </tr>
            <tr>
                <td style="width:60px;"><span class="badge badge-primary">类型</span></td>
                <td>
                    <span id="elementtype">
                    <select id="type" onchange="changetype()">
                        <option value="-1">Null</option>
                        <option value="primary">primary</option>
                        <option value="secondary">secondary</option>
                        <option value="success">success</option>
                        <option value="danger">danger</option>
                        <option value="warning">warning</option>
                        <option value="info">info</option>
                        <option value="light">light</option>
                        <option value="dark">dark</option>
                    </select>
                    </span>
                </td>
            </tr>

        </table>
    </div>

</div>
<div class="state" style="min-height: 30px;">

</div>
<div class="state1">
    <button id="create0" onclick="create(0)">添加节点</button>
    <button onclick="alert(nodelist.length)">节点个数</button>
</div>

<script src="js/bootstrap.min.js"></script>
<script>
    //node类
    nodenum=0;
    nodelist=new Array();

    var Node={

        createNew:function(type){
            //
            var node={};
            node.id="node"+nodenum;
            node.name="node"+nodenum;
            node.active=false;
            node.position=[0,0];
            node.content=node.id;
            var types=["primary","secondary","success","danger","warning","info","light","dark"];
            node.type=types[type];
            node.create=function(){
                var htmltext="<button id="+node.id+" type=\"button\" class=\"btn btn-lg btn-outline-"+node.type+" node\">"+node.content+"</button>";
                $("#background").append(htmltext);
                nodelist[nodenum]=node;
                nodenum++;
            };
            //console.log(nodelist);
            return node;
        },
        setnodetype:function(id,type){
            nodelist[id].type=type;
            this.drawnodeupdate(id);
        },
        setnodeactive:function(id,active){
            nodelist[id].active=active;
            this.drawnodeupdate(id);
        },
        setnodeposition:function(id,x,y){
            nodelist[id].position=[x,y];
            this.drawnodeupdate(id);
        },
        drawnodeupdate:function(id)
        {
            var isactive=nodelist[id].active?" active":"";
            $("#node"+id).attr("class","");
            $("#node"+id).attr("class","btn btn-lg btn-outline-"+nodelist[id].type+" node"+isactive);
            var css = {
                //css
                left:nodelist[id].position[0]+"px",
                top:nodelist[id].position[1]+"px"
            };
            $("#node"+id).css(css);



        }

    };


    function create(type)
    {
        var newnode=Node.createNew(type);
        newnode.create();
    }
    function changetype()
    {
        //alert($("#type").val());
        Node.setnodetype(selectnodenum,$("#type").val());
    }
    //
    var selectelement=null;
    var selectnode={};
    var selectnodenum=null;
    //声明需要用到的变量
    var mx = 0,my = 0;      //鼠标x、y轴坐标（相对于left，top）
    var dx = 0,dy = 0;      //对话框坐标（同上）
    var isDraging = false;      //不可拖动

    $('body').on('mousedown','.node',function(e){
        selectelement=$(this);

        selectnodenum=this.id.replace("node","");//获取node的id数字
        // console.log(Node.getnodebyId(getnodenum));
        selectnode=nodelist[selectnodenum];
        console.log(nodelist[selectnodenum]);


        e = e || window.event;
        mx = e.pageX;     //点击时鼠标X坐标
        my = e.pageY;     //点击时鼠标Y坐标
        dx = selectelement.offset().left;
        dy = selectelement.offset().top;
        //Node.setnodeposition(selectnodenum,dx,dy);
        isDraging = true;      //标记对话框可拖动
        $('.state').text("true");
        //侧边栏显示数据
        showattr(selectnode);
    });

    $('body').on('mousemove','#background',function(e) {
        var e = e || window.event;
        var x = e.pageX;      //移动时鼠标X坐标
        var y = e.pageY;      //移动时鼠标Y坐标
        if(isDraging){        //判断对话框能否拖动
            var moveX = dx + x - mx;      //移动后对话框新的left值
            var moveY = dy + y - my;      //移动后对话框新的top值
            //设置拖动范围

            var dialogW = selectelement.width();
            var dialogH = selectelement.height();
            var pageW = $("#background").width()-0.5*dialogW+10;
            var pageH = $("#background").height()-0.5*dialogH-5;
            var maxX = pageW - dialogW;       //X轴可拖动最大值
            var maxY = pageH - dialogH;       //Y轴可拖动最大值
            moveX = Math.min(Math.max(0,moveX),maxX);     //X轴可拖动范围
            moveY = Math.min(Math.max(0,moveY),maxY);     //Y轴可拖动范围
            //重新设置对话框的left、top
            //selectelement.css({"left":moveX + 'px',"top":moveY + 'px'});
            Node.setnodeposition(selectnodenum,moveX.toFixed(0),moveY.toFixed(0));
            showattr(selectnode);
        };
    });

    $('body').on('mouseup','.row',function(){
        //selectelement=$(this);
        isDraging = false;
        $('.state').text("false");
        //update

    });

    $('body').on('mousedown','#setactive',function() {
        Node.setnodeactive(selectnodenum,true);
        showattr(selectnode);
    });

    $('body').on('mousedown','#setinactive',function() {
        Node.setnodeactive(selectnodenum,false);
        inactive();
    });

    function showattr(node)
    {
        //id
        $("#elementid").text(node.id);
        //名称
        $("#elementname").text(node.name);
        //位置
        $("#elementpos").text("X="+node.position[0]+",Y="+node.position[1]);
        //状态
        $("#elementstatus").text(node.active?"Active":"Inactive");
        //类型
        $("#type").val(node.type);
    }
</script>

</body>
</html>